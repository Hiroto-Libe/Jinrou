<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Jinrou - å¤œãƒ•ã‚§ãƒ¼ã‚ºï¼ˆå ã„å¸«ï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #020617;
      color: #e5e7eb;
    }
    header {
      padding: 12px 16px;
      background: #020617;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #1f2937;
    }
    header .room {
      font-size: 12px;
      color: #9ca3af;
    }
    header .phase-badge {
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #4b5563;
    }
    main {
      padding: 16px;
      max-width: 480px;
      margin: 0 auto;
    }
    .role-card {
      border-radius: 12px;
      padding: 16px;
      background: #111827;
      border: 1px solid #1f2937;
      margin-bottom: 16px;
    }
    .role-label {
      font-size: 12px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .role-name {
      font-size: 18px;
      font-weight: 700;
      color: #38bdf8;
    }
    .hint {
      font-size: 13px;
      color: #9ca3af;
      margin-top: 4px;
      line-height: 1.4;
    }
    .section-title {
      font-size: 14px;
      font-weight: 600;
      margin: 16px 0 8px;
    }
    .target-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }
    .target-btn {
      width: 100%;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      text-align: left;
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .target-btn span {
      pointer-events: none;
    }
    .target-btn .sub {
      font-size: 11px;
      color: #9ca3af;
    }
    .target-btn.selected {
      border-color: #38bdf8;
      background: #0f172a;
    }
    .primary-btn {
      width: 100%;
      padding: 12px;
      border-radius: 999px;
      border: none;
      background: #38bdf8;
      color: white;
      font-size: 15px;
      font-weight: 600;
      margin-top: 4px;
    }
    .primary-btn:disabled {
      opacity: 0.4;
    }
    .info {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 8px;
      line-height: 1.4;
    }
    .result-card {
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid #1f2937;
      background: #020617;
      font-size: 13px;
    }
    .result-card .label {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .result-card .player {
      font-weight: 600;
    }
    .result-card .white {
      color: #22c55e;
    }
    .result-card .black {
      color: #f97373;
    }
    .status-row {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: #9ca3af;
      margin-top: 16px;
    }
  </style>
  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams(window.location.search);
    const gameId = params.get("game_id");
    const playerId = params.get("player_id");

    const cards = document.querySelectorAll(".inspect-card");
    const inspectButton = document.querySelector(".inspect-button");
    const resultText = document.querySelector(".result-text");
    const logContainer = document.querySelector(".log-container");

    let selectedTargetId = null;

    function appendLog(text, type = "system") {
      const item = document.createElement("div");
      item.className = "log-item";
      const timeSpan = document.createElement("span");
      timeSpan.className = "log-time";
      const now = new Date();
      timeSpan.textContent = `[${now.getHours().toString().padStart(2, "0")}:${now.getMinutes().toString().padStart(2, "0")}]`;

      const bodySpan = document.createElement("span");
      bodySpan.className = type === "you" ? "log-you" : "log-system";
      bodySpan.textContent = type === "you" ? `[You] ${text}` : `[System] ${text}`;

      item.appendChild(timeSpan);
      item.appendChild(bodySpan);
      logContainer.appendChild(item);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    cards.forEach(card => {
      const id = card.getAttribute("data-member-id");
      if (!id) return;

      card.addEventListener("click", () => {
        selectedTargetId = id;
        cards.forEach(c => c.classList.remove("selected"));
        card.classList.add("selected");
        inspectButton.disabled = false;
      });
    });

    inspectButton.addEventListener("click", async () => {
      if (!gameId || !playerId || !selectedTargetId) return;

      inspectButton.disabled = true;
      resultText.textContent = "å ã„çµæœã‚’å–å¾—ä¸­â€¦";

      try {
        const res = await fetch(`/api/games/${encodeURIComponent(gameId)}/night/seer/inspect`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            seer_player_id: playerId,      // â˜… APIä»•æ§˜ã«åˆã‚ã›ã¦å¤‰æ›´
            target_member_id: selectedTargetId,
          }),
        });

        if (!res.ok) {
          const err = await res.json().catch(() => null);
          const detail = err?.detail ?? `HTTP ${res.status}`;
          appendLog(`å ã„ã«å¤±æ•—ã—ã¾ã—ãŸ: ${detail}`, "system");
          resultText.textContent = "å ã„ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ã‚„ã‚Šç›´ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚";
          return;
        }

        const data = await res.json(); // ä¾‹: { is_wolf: true, target_role: "wolf" } ãªã©
        const isWolf = data.is_wolf;   // â˜… å®Ÿéš›ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«åˆã‚ã›ã¦å¤‰æ›´

        const targetName = document.querySelector(
          `.inspect-card[data-member-id="${selectedTargetId}"] .display`
        )?.textContent ?? "å¯¾è±¡";

        const resultLabel = isWolf ? "äººç‹¼" : "äººç‹¼ã§ã¯ãªã„ï¼ˆç™½ï¼‰";
        resultText.textContent = `ã€Œ${targetName}ã€ã¯ ${resultLabel} ã¨åˆ¤å®šã•ã‚Œã¾ã—ãŸã€‚`;
        appendLog(`ã€Œ${targetName}ã€ã‚’å ã„ã¾ã—ãŸã€‚çµæœ: ${resultLabel}`, "you");

        // ä»¥é™ã¯å†æ“ä½œç¦æ­¢
        cards.forEach(c => c.classList.add("disabled"));
      } catch (e) {
        console.error(e);
        appendLog("ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚", "system");
        resultText.textContent = "é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
      }
    });
  });
</script>

</head>
<body>
  <header>
    <div>
      <div>Jinrou</div>
      <div class="room">Room: <strong>ABCD</strong></div>
    </div>
    <div class="phase-badge">å¤œãƒ•ã‚§ãƒ¼ã‚º</div>
  </header>

  <main>
    <section class="role-card">
      <div class="role-label">ã‚ãªãŸã®å½¹è·</div>
      <div class="role-name">å ã„å¸«</div>
      <p class="hint">
        ä»Šå¤œã€<strong>1äºº</strong>ã‚’å ã£ã¦ã€Œäººç‹¼ã‹ã©ã†ã‹ã€ã‚’ç¢ºèªã§ãã¾ã™ã€‚<br>
        ç‹‚äººï¼ˆMADMANï¼‰ã¯å ã„ã§ã¯<strong>ç™½</strong>ã¨ã—ã¦åˆ¤å®šã•ã‚Œã¾ã™ã€‚
      </p>
    </section>

    <section>
      <h2 class="section-title">ä»Šå¤œå ã†ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</h2>

      <!-- å®Ÿè£…æ™‚: ç”Ÿå­˜ä¸­ã‹ã¤è‡ªåˆ†ä»¥å¤–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä¸€è¦§è¡¨ç¤º -->
      <div class="target-list">
        <button class="target-btn selected">
          <span>ãŸãªã‹</span>
          <span class="sub">ç”Ÿå­˜</span>
        </button>
        <button class="target-btn">
          <span>ã•ã¨ã†</span>
          <span class="sub">ç”Ÿå­˜</span>
        </button>
        <button class="target-btn">
          <span>ã™ãšã</span>
          <span class="sub">ç”Ÿå­˜</span>
        </button>
      </div>

      <!-- å®Ÿè£…æ™‚: ä»Šå¤œã®å ã„ãŒæœªå®Ÿè¡Œãªã‚‰ enabled / å®Ÿè¡Œæ¸ˆãªã‚‰ disabled -->
      <button class="primary-btn">
        ã“ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’å ã†
      </button>

      <p class="info">
        â€» å ã„ã¯<strong>1æ™©ã«1å›ã®ã¿</strong>ã§ã™ã€‚å®Ÿè¡Œå¾Œã¯ä»Šå¤œã¯å†åº¦å ãˆã¾ã›ã‚“ã€‚<br>
        â€» æ—¢ã«å ã„æ¸ˆã¿ã®å¤œã¯ã€APIå´ã§ 400 ã‚’è¿”ã™æƒ³å®šã§ã™ã€‚
      </p>
    </section>

    <section>
      <h2 class="section-title">ä»Šå¤œã®å ã„çµæœ</h2>

      <!-- å®Ÿè£…æ™‚: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å¿œã˜ã¦å†…å®¹ã‚’å·®ã—æ›¿ãˆ -->
      <div class="result-card">
        <div class="label">ç›´è¿‘ã®çµæœ</div>
        <div>
          <span class="player">ãŸãªã‹</span> ã•ã‚“ã¯
          <span class="white">äººç‹¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼ˆç™½ï¼‰</span>
        </div>
      </div>

      <!-- ä¾‹: äººç‹¼ã ã£ãŸå ´åˆ
      <div class="result-card">
        <div class="label">ç›´è¿‘ã®çµæœ</div>
        <div>
          <span class="player">ã•ã¨ã†</span> ã•ã‚“ã¯
          <span class="black">äººç‹¼ã§ã™ï¼ˆé»’ï¼‰</span>
        </div>
      </div>
      -->
    </section>

    <div class="status-row">
      <span>â± æ®‹ã‚Šæ™‚é–“: 01:23</span>
      <span>ğŸ‘ ä»Šå¤œã®å ã„: æ¸ˆ</span>
    </div>
  </main>
</body>
</html>
