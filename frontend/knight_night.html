<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>å¤œãƒ•ã‚§ãƒ¼ã‚º - é¨å£«</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: system-ui, sans-serif; margin: 16px; }
    h1 { font-size: 1.4rem; margin-bottom: 8px; }
    .info { font-size: 0.9rem; margin-bottom: 12px; color: #555; }
    .members {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 16px;
    }
    .member-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 8px;
      text-align: center;
      cursor: pointer;
      user-select: none;
      background: #fff;
    }
    .member-card.dead { opacity: 0.4; cursor: not-allowed; }
    .member-card.self { opacity: 0.4; cursor: not-allowed; }
    .member-card.selected {
      border-color: #0066cc;
      box-shadow: 0 0 0 2px rgba(0,102,204,0.2);
    }
    button {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-size: 1rem;
    }
    button:disabled { opacity: 0.5; }
    .primary { background: #0066cc; color: #fff; }
    .log { margin-top: 16px; font-size: 0.9rem; white-space: pre-wrap; }
    .error { color: #b00020; }
    .success { color: #006400; }
  </style>
</head>
<body>
  <h1>å¤œãƒ•ã‚§ãƒ¼ã‚ºï¼šé¨å£«</h1>
  <div class="info">
    ã‚ãªãŸã®å½¹è·ï¼š<strong>é¨å£«</strong><br>
    ä»Šå¤œã€<strong>1äººã ã‘</strong>ã‚’è­·è¡›ã§ãã¾ã™ã€‚<br>
    è‡ªåˆ†ã¨æ­»äº¡è€…ã¯é¸ã¹ã¾ã›ã‚“ï¼ˆè‡ªå·±è­·è¡›ç¦æ­¢ï¼‰ã€‚
  </div>

  <div id="status" class="info"></div>

  <div id="member-list" class="members"></div>

  <button id="guard-btn" class="primary" disabled>ã“ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’è­·è¡›ã™ã‚‹</button>

  <div id="result" class="log"></div>

  <script src="/frontend/js/night_common.js"></script>
  <script>
    JinrouNight.initNightRolePage({
      expectedRole: 'knight',
      elements: {
        statusId: 'status',
        membersId: 'member-list',
        buttonId: 'guard-btn',
        resultId: 'result',
      },
      buildEndpoint: (gameId) =>
        `/api/games/${encodeURIComponent(gameId)}/knight/guard`,
      buildRequestBody: ({ me, targetMember }) => ({
        knight_member_id: me.player_id,
        target_member_id: targetMember.id,
      }),
      buildSuccessMessage: ({ data, targetMember }) => {
        const name = data.target_name || targetMember.name || 'ç›¸æ‰‹';
        return `ğŸ›¡ ${name} ã•ã‚“ã‚’è­·è¡›ã—ã¾ã—ãŸã€‚è¥²æ’ƒãŒæ¥ã¦ã‚‚å®ˆã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚`;
      },
      texts: {
        loadingMe: 'é¨å£«ã®æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...',
        loadingGame: 'ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§ã‚’å–å¾—ä¸­...',
        selectPrompt: 'è­·è¡›ã™ã‚‹ç›¸æ‰‹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚',
        roleMismatch:
          'ã‚ãªãŸã¯é¨å£«ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã®ç”»é¢ã‹ã‚‰ã¯æ“ä½œã§ãã¾ã›ã‚“ã€‚',
        doneStatus: 'ä»Šå¤œã®è­·è¡›ã¯å®Œäº†ã—ã¾ã—ãŸã€‚ä»–ã®äººã®ã‚¿ãƒ¼ãƒ³ã‚’å¾…ã£ã¦ãã ã•ã„ã€‚',
      },
    });
  </script>
</body>
</html>
